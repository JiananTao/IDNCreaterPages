"use strict";(self["webpackChunkIDNCreaterPages"]=self["webpackChunkIDNCreaterPages"]||[]).push([[207],{3226:function(e,t,n){n.d(t,{W:function(){return o}});var r=n(2386);const o=(0,r.Q_)("novelState",{state:()=>({currentNovel:null,novels:[{title:"111",cover:"/availableNovels/111-cover.png",path:"../../public/availableNovels/111.txt",content:null}]}),actions:{async setCurrentNovel(e){this.currentNovel=e},setNovelContent(e,t){this.novels[e].content=t}}})},6095:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}});var r=n(8473),o=n(4887);const s={key:0,class:"header"},a=(0,r._)("h1",{class:"h1"},"Mulit-Author Interactive Novel Reader",-1),i={class:"h1"},l={key:0},c=(0,r._)("hr",null,null,-1),h=["innerHTML"],u=["innerHTML"];function d(e,t,n,d,p,g){const v=(0,r.up)("ReaderTutorial");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(v),d.store.btnToggle?((0,r.wg)(),(0,r.iD)("header",s,[a,(0,r._)("button",{class:"button",onClick:t[0]||(t[0]=e=>g.importFile())},"Import")])):(0,r.kq)("",!0),(0,r._)("div",null,[(0,r._)("button",{onClick:t[1]||(t[1]=(...e)=>g.preScene&&g.preScene(...e))},"⬅️"),(0,r.Uk)("  "),(0,r._)("h1",i,(0,o.zw)(p.novel.title),1),p.novel.author?((0,r.wg)(),(0,r.iD)("p",l,"Written by "+(0,o.zw)(p.novel.author),1)):(0,r.kq)("",!0),c,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(p.readContents,((e,t)=>((0,r.wg)(),(0,r.iD)("div",{key:t,class:"read-content",innerHTML:e},null,8,h)))),128)),(0,r._)("p",{class:"content",innerHTML:g.highlightedCurrentSceneContent,onClick:t[2]||(t[2]=(...e)=>g.handleWordClick&&g.handleWordClick(...e))},null,8,u)]),(0,r._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[3]||(t[3]=(...e)=>g.onFileInputChange&&g.onFileInputChange(...e))},null,32)])}n(7658);var p=n(3226),g=n(7080),v=n(9197);const I={key:0,class:"tutorial"},x=(0,r._)("div",{class:"tutorial-item"},[(0,r._)("button",{class:"button"},"Import"),(0,r._)("p",null,"点击这个按钮可以导入一个电子书籍。")],-1),S=(0,r._)("div",{class:"tutorial-item"},[(0,r._)("span",null,"In a"),(0,r._)("span",{class:"highlighted-word"}," distant"),(0,r._)("span",null,"land"),(0,r._)("p",null,"点击发蓝光文字可以前往关键词对应的下一故事进展。")],-1),w=(0,r._)("div",{class:"tutorial-item"},[(0,r._)("button",{class:"preScene-btn"},"⬅️"),(0,r._)("p",null,"点击这个按钮可以返回到上一个关键词所在的段落。")],-1),f=[x,S,w];function C(e,t,n,o,s,a){return(0,r.wg)(),(0,r.j4)(v.uT,{name:"fade"},{default:(0,r.w5)((()=>[this.store.tutorialToggle?((0,r.wg)(),(0,r.iD)("div",I,f)):(0,r.kq)("",!0)])),_:1})}var m={setup(){const e=(0,g.o)();return{store:e}}},_=n(5312);const k=(0,_.Z)(m,[["render",C]]);var b=k,N={components:{ReaderTutorial:b},setup(){const e=(0,g.o)(),t=(0,p.W)();return{store:e,novelStore:t}},data(){return{readContents:[],readingOrder:[],novel:{title:"",author:"",content:""},paragraphs:[],currentScene:{sourceIndex:"",wordIndex:"",content:""}}},created(){this.fromHome()},computed:{highlightedCurrentSceneContent(){let e=this.currentScene.content;return this.paragraphs.forEach((t=>{if(t.sourceIndex===this.currentScene.paragraphIndex){const n=new RegExp(`(${t.wordIndex})`,"gi");e=e.replace(n,'<span class="highlighted-word">$1</span>')}})),e}},methods:{fromHome(){return this.$route.query.startReading&&(null!=this.novelStore.currentNovel?(this.parseNovelText(this.novelStore.currentNovel),console.log(this.novelStore.currentNovel)):alert("请先前往community界面刷新后选中书籍")),null},preScene(){if(this.readingOrder.length>1){const e=this.readingOrder[this.readingOrder.length-1],t=this.paragraphs.find((t=>t.paragraphIndex===e));this.readingOrder.pop(),this.readContents.pop(),t?(this.currentScene.sourceIndex=t.sourceIndex,this.currentScene.wordIndex=t.wordIndex,this.currentScene.content=t.content,this.currentScene.paragraphIndex=t.paragraphIndex):alert("没找到上一个场景，请确定你不是在第一个场景内")}else alert("已经是第一个场景，无法返回")},importFile(){document.getElementById("file-input").click()},onFileInputChange(e){const t=e.target.files[0],n=new FileReader;n.onload=e=>{const t=e.target.result;this.parseNovelText(t)},n.readAsText(t)},parseNovelText(e){const t=e.trim().split("\n");let n="",r="",o="",s=0;this.store.btnToggle=!this.store.btnToggle;for(let i of t)i.startsWith("Story Title: ")?n=i.slice(13):i.startsWith("Authors: ")?r=i.slice(9):(o+=i+"<br/>",s+=1);this.novel.title=n,this.novel.author=r,this.novel.content=o;const a=o.split("<br/>");for(let i=0;i<s+1;i++)this.paragraphs.push({sourceIndex:null,wordIndex:null,content:"",paragraphIndex:i});a.forEach(((e,t)=>{const n=e.match(/\[(\d+)\] \[(.*?)\] (.+) \[(\d+)\]/);if(n){const e=parseInt(n[1]),r=n[2],o=n[3],s=parseInt(n[4]);this.paragraphs[s].sourceIndex=e,this.paragraphs[s].wordIndex=r,this.paragraphs[s].content=o,this.paragraphs[s].paragraphIndex=s,0===t&&(this.currentScene.sourceIndex=e,this.currentScene.wordIndex=r,this.currentScene.content=o,this.currentScene.paragraphIndex=s,this.readingOrder.push(this.currentScene.paragraphIndex))}}))},handleWordClick(e){const t=e.target.closest(".highlighted-word");if(t){const e=t.textContent.trim(),n=this.paragraphs.find((t=>t.sourceIndex===this.currentScene.paragraphIndex&&t.wordIndex.toLowerCase()===e.toLowerCase()));n?(this.readContents.push(this.currentScene.content),this.readingOrder.push(this.currentScene.paragraphIndex),this.currentScene.sourceIndex=n.sourceIndex,this.currentScene.wordIndex=n.wordIndex,this.currentScene.content=n.content,this.currentScene.paragraphIndex=n.paragraphIndex):alert("No scene is connected to this word.")}}}};const T=(0,_.Z)(N,[["render",d]]);var y=T}}]);
//# sourceMappingURL=reader.76888129.js.map