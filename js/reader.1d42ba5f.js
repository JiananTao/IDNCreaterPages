"use strict";(self["webpackChunkIDNCreaterPages"]=self["webpackChunkIDNCreaterPages"]||[]).push([[207],{3226:function(e,t,n){n.d(t,{W:function(){return s}});var r=n(2386);const s=(0,r.Q_)("novelState",{state:()=>({currentNovel:null,novels:[]}),actions:{async setCurrentNovel(e){this.currentNovel=e},setNovelContent(e,t){this.novels[e].content=t}}})},4341:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(8473),s=n(4887);const a={key:0,class:"header"},o=(0,r._)("h1",{class:"h1"},"Mulit-Author Interactive Novel Reader",-1),i={class:"h1"},l={key:0},c=(0,r._)("hr",null,null,-1),h=["innerHTML"],d=["innerHTML"];function u(e,t,n,u,p,g){const I=(0,r.up)("ReaderTutorial");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(I),u.store.btnToggle?((0,r.wg)(),(0,r.iD)("header",a,[o,(0,r._)("button",{class:"button",onClick:t[0]||(t[0]=e=>g.importFile())},"Import")])):(0,r.kq)("",!0),(0,r._)("div",null,[(0,r._)("h1",i,(0,s.zw)(p.novel.title),1),p.novel.author?((0,r.wg)(),(0,r.iD)("p",l,"Written by "+(0,s.zw)(p.novel.author),1)):(0,r.kq)("",!0),c,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(g.highlightedReadContents,((e,t)=>((0,r.wg)(),(0,r.iD)("div",{key:t,class:"read-content",innerHTML:e},null,8,h)))),128)),(0,r._)("p",{class:"content",innerHTML:g.highlightedCurrentSceneContent,onClick:t[1]||(t[1]=(...e)=>g.handleWordClick&&g.handleWordClick(...e))},null,8,d)]),(0,r._)("button",{style:{all:"unset",cursor:"pointer"},onClick:t[2]||(t[2]=(...e)=>g.preScene&&g.preScene(...e))},"back to previous scene"),(0,r.Uk)("  "),(0,r._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[3]||(t[3]=(...e)=>g.onFileInputChange&&g.onFileInputChange(...e))},null,32)])}n(7658);var p=n(3226),g=n(7080),I=n(9197);const x={key:0,class:"tutorial"},v=(0,r._)("div",{class:"tutorial-item"},[(0,r._)("button",{class:"button"},"Import"),(0,r._)("p",null,"Click this button to import an eBook.")],-1),w=(0,r._)("div",{class:"tutorial-item"},[(0,r._)("span",null,"In a"),(0,r._)("span",{class:"highlighted-word"}," distant"),(0,r._)("span",null,"land"),(0,r._)("p",null,"Click on the blue light text to go to the next story progress corresponding to the keyword.")],-1),f=(0,r._)("div",{class:"tutorial-item"},[(0,r._)("button",{class:"preScene-btn"},"⬅️"),(0,r._)("p",null,"Click this button to return to the paragraph where the previous keyword is located.")],-1),C=[v,w,f];function S(e,t,n,s,a,o){return(0,r.wg)(),(0,r.j4)(I.uT,{name:"fade"},{default:(0,r.w5)((()=>[this.store.tutorialToggle?((0,r.wg)(),(0,r.iD)("div",x,C)):(0,r.kq)("",!0)])),_:1})}var k={setup(){const e=(0,g.o)();return{store:e}}},m=n(5312);const y=(0,m.Z)(k,[["render",S]]);var _=y,T={components:{ReaderTutorial:_},setup(){const e=(0,g.o)(),t=(0,p.W)();return{store:e,novelStore:t}},data(){return{readContents:[],selectedWords:[],readingOrder:[],novel:{title:"",author:"",content:""},paragraphs:[],currentScene:{sourceIndex:"",wordIndex:"",content:""},index:0}},created(){this.fromCommunity()},computed:{highlightedReadContents(){return this.readContents.map(((e,t)=>{const n=this.selectedWords[t];if(n){const t=new RegExp(`(${n})`,"gi");return e.replace(t,'<span class="highlighted-word-underlined">$1</span>')}return e}))},highlightedCurrentSceneContent(){let e=this.currentScene.content;return this.paragraphs.forEach((t=>{if(t.sourceIndex===this.currentScene.paragraphIndex){const n=new RegExp(`(${t.wordIndex})`,"gi");e=e.replace(n,'<span class="highlighted-word">$1</span>')}})),e}},methods:{fromCommunity(){return this.$route.query.startReading&&(null!=this.novelStore.currentNovel?this.parseNovelText(this.novelStore.currentNovel):alert("Please go to the community interface to select the book")),null},preScene(){if(this.readingOrder.length>1){const e=this.readingOrder[this.readingOrder.length-1],t=this.paragraphs.find((t=>t.paragraphIndex===e));this.readingOrder.pop(),this.readContents.pop(),this.selectedWords.pop(),t?(this.currentScene.sourceIndex=t.sourceIndex,this.currentScene.wordIndex=t.wordIndex,this.currentScene.content=t.content,this.currentScene.paragraphIndex=t.paragraphIndex):alert("The previous scene was not found, please make sure you are not in the first scene")}else alert("Already the first scene, can't go back")},importFile(){document.getElementById("file-input").click()},onFileInputChange(e){const t=e.target.files[0],n=new FileReader;n.onload=e=>{const t=e.target.result;this.parseNovelText(t)},n.readAsText(t)},parseNovelText(e){const t=e.trim().split("\n");let n="",r="",s="",a=0;for(let i of t)i.startsWith("Story Title: ")?n=i.slice(13):i.startsWith("Authors: ")?r=i.slice(9):(s+=i+"<br/>",a+=1);this.novel.title=n,this.novel.author=r,this.novel.content=s;const o=s.split("<br/>");for(let i=0;i<a+1;i++)this.paragraphs.push({sourceIndex:null,wordIndex:null,content:"",paragraphGoTo:i,paragraphIndex:i});this.index=0,o.forEach(((e,t)=>{const n=e.match(/\[(\d+)\] \[(.*?)\] (.*) \[(\d+)\]/);if(n){const e=parseInt(n[1]),r=n[2],s=n[3].replaceAll('"',"'"),a=parseInt(n[4]);this.index+=1,this.paragraphs[t].sourceIndex=e,this.paragraphs[t].wordIndex=""===r?" ":r,this.paragraphs[t].content=s,this.paragraphs[t].paragraphGoTo=a,0===t&&(this.currentScene.sourceIndex=e,this.currentScene.wordIndex=r,this.currentScene.content=s,this.currentScene.paragraphIndex=a,this.readingOrder.push(this.currentScene.paragraphIndex)),"GOTOEXISTINGNODE"===s.replaceAll(" ","")?(this.index-=1,this.paragraphs[t].paragraphIndex=0):this.paragraphs[t].paragraphIndex=a}}))},handleWordClick(e){const t=e.target.closest(".highlighted-word");if(t){const e=t.textContent.trim();let n=this.paragraphs.find((t=>t.sourceIndex===this.currentScene.paragraphIndex&&t.wordIndex.toLowerCase()===e.toLowerCase()));n&&0==n.paragraphIndex&&(n=this.paragraphs.find((e=>n.paragraphGoTo===e.paragraphIndex))),n?(this.selectedWords.push(e),this.readContents.push(this.currentScene.content),this.readingOrder.push(this.currentScene.paragraphIndex),this.currentScene.sourceIndex=n.sourceIndex,this.currentScene.wordIndex=n.wordIndex,this.currentScene.content=n.content,this.currentScene.paragraphIndex=n.paragraphIndex):alert("No scene is connected to this word.")}}}};const b=(0,m.Z)(T,[["render",u]]);var N=b}}]);
//# sourceMappingURL=reader.1d42ba5f.js.map