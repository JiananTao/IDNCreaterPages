"use strict";(self["webpackChunkIDNCreaterPages"]=self["webpackChunkIDNCreaterPages"]||[]).push([[207],{4371:function(e,t,n){n.r(t),n.d(t,{default:function(){return x}});var r=n(3396),a=n(7139);const s={class:"reader"},i={key:2,class:"header"},o=(0,r._)("h1",{class:"h1"},"Mulit-Author Interactive Novel Reader",-1),c={class:"h1"},h={key:0},l=(0,r._)("hr",null,null,-1),d=["innerHTML"];function u(e,t,n,u,p,g){return(0,r.wg)(),(0,r.iD)("div",s,[p.up?((0,r.wg)(),(0,r.iD)("button",{key:0,class:"toggle-btn",onClick:t[0]||(t[0]=(...e)=>g.toggleHeader&&g.toggleHeader(...e))},"Pack Up")):(0,r.kq)("",!0),p.up?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("button",{key:1,class:"toggle-btn",onClick:t[1]||(t[1]=(...e)=>g.toggleHeader&&g.toggleHeader(...e))},"Down")),p.isHeaderVisible?((0,r.wg)(),(0,r.iD)("header",i,[o,(0,r._)("button",{class:"button",onClick:t[2]||(t[2]=e=>g.importFile())},"Import")])):(0,r.kq)("",!0),(0,r._)("div",null,[(0,r._)("button",{onClick:t[3]||(t[3]=(...e)=>g.preScene&&g.preScene(...e))},"⬅️"),(0,r.Uk)("  "),(0,r._)("h1",c,(0,a.zw)(p.novel.title),1),p.novel.author?((0,r.wg)(),(0,r.iD)("p",h,"Written by "+(0,a.zw)(p.novel.author),1)):(0,r.kq)("",!0),l,(0,r._)("p",{class:"content",innerHTML:g.highlightedCurrentSceneContent,onClick:t[4]||(t[4]=(...e)=>g.handleWordClick&&g.handleWordClick(...e))},null,8,d)]),(0,r._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[5]||(t[5]=(...e)=>g.onFileInputChange&&g.onFileInputChange(...e))},null,32)])}n(7658);var p={data(){return{isHeaderVisible:!0,up:!0,novel:{title:"",author:"",content:""},paragraphs:[],currentScene:{sourceIndex:"",wordIndex:"",content:""},readingOrder:[]}},computed:{fromHome(){return this.$route.query.startReading&&this.parseNovelText(this.$route.query.story),null},highlightedCurrentSceneContent(){let e=this.currentScene.content;return this.paragraphs.forEach((t=>{if(t.sourceIndex===this.currentScene.paragraphIndex){const n=new RegExp(`(${t.wordIndex})`,"gi");e=e.replace(n,'<span class="highlighted-word">$1</span>')}})),e}},methods:{preScene(){const e=this.readingOrder.pop(),t=this.paragraphs.find((t=>t.paragraphIndex===e));t?(this.currentScene.sourceIndex=t.sourceIndex,this.currentScene.wordIndex=t.wordIndex,this.currentScene.content=t.content,this.currentScene.paragraphIndex=t.paragraphIndex):alert("没找到上一个场景，请确定你不是在第一个场景内")},updateScene(){this.readingOrder.push(this.currentScene.paragraphIndex)},toggleHeader(){this.isHeaderVisible=!this.isHeaderVisible,this.up=!this.up},importFile(){document.getElementById("file-input").click()},onFileInputChange(e){const t=e.target.files[0],n=new FileReader;n.onload=e=>{const t=e.target.result;this.parseNovelText(t)},n.readAsText(t)},parseNovelText(e){const t=e.trim().split("\n");let n="",r="",a="",s=0;this.toggleHeader();for(let o of t)o.startsWith("Story Title: ")?n=o.slice(13):o.startsWith("Authors: ")?r=o.slice(9):(a+=o+"<br/>",s+=1);this.novel.title=n,this.novel.author=r,this.novel.content=a;const i=a.split("<br/>");for(let o=0;o<s;o++)this.paragraphs.push({sourceIndex:null,wordIndex:null,content:"",paragraphIndex:o});i.forEach(((e,t)=>{const n=e.match(/\[(\d+)\] \[(.*?)\] (.+) \[(\d+)\]/);if(n){const e=parseInt(n[1]),r=n[2],a=n[3],s=parseInt(n[4]);this.paragraphs[s].sourceIndex=e,this.paragraphs[s].wordIndex=r,this.paragraphs[s].content=a,this.paragraphs[s].paragraphIndex=s,0===t&&(this.currentScene.sourceIndex=e,this.currentScene.wordIndex=r,this.currentScene.content=a,this.currentScene.paragraphIndex=s,this.updateScene())}}))},handleWordClick(e){const t=e.target.closest(".highlighted-word");if(t){const e=t.textContent.trim(),n=this.paragraphs.find((t=>t.sourceIndex===this.currentScene.paragraphIndex&&t.wordIndex.toLowerCase()===e.toLowerCase()));n?(this.updateScene(),this.currentScene.sourceIndex=n.sourceIndex,this.currentScene.wordIndex=n.wordIndex,this.currentScene.content=n.content,this.currentScene.paragraphIndex=n.paragraphIndex):alert("No scene is connected to this word.")}}}},g=n(89);const I=(0,g.Z)(p,[["render",u]]);var x=I}}]);
//# sourceMappingURL=reader.dd6e1e53.js.map