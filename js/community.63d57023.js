"use strict";(self["webpackChunkIDNCreaterPages"]=self["webpackChunkIDNCreaterPages"]||[]).push([[587],{7531:function(e,t,o){o.r(t),o.d(t,{default:function(){return J}});var s=o(8473),l=o(4887);const a={class:"community"},n={key:0,class:"header"},i=(0,s._)("h1",{class:"h1"},"IDN Community",-1),r=[i],c={class:"header"},u=(0,s._)("h2",null,"Popular Novels For Reading",-1),d=(0,s._)("br",null,null,-1),h={class:"novels-container"},v=["onClick"],g=["src","alt"];function p(e,t,o,i,p,m){const f=(0,s.up)("CommunityTutorial");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(f),i.store.btnToggle?((0,s.wg)(),(0,s.iD)("header",n,r)):(0,s.kq)("",!0),(0,s._)("header",c,[u,(0,s._)("button",{class:"button",onClick:t[0]||(t[0]=e=>m.importFile())},"Submit Image/Text"),(0,s._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[1]||(t[1]=(...e)=>m.onFileInputChange&&m.onFileInputChange(...e))},null,32)]),d,(0,s._)("div",h,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(this.novelStore.novels,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{class:"novel-item",key:e.title},[(0,s._)("div",null,[(0,s._)("div",{onClick:e=>m.readNovel(t)},[(0,s._)("img",{src:e.cover,alt:e.title,class:"novel-cover"},null,8,g)],8,v)]),(0,s._)("h3",null,(0,l.zw)(e.title),1)])))),128))])])}o(7658);var m=o(3226),f=o(7080),b=o(5667),y=o(5204),F=o(4716),w=o(7818),k=o(9197);const T={key:0,class:"tutorial"},_=(0,s._)("div",{class:"tutorial-item"},[(0,s._)("h1",null,"The IDN Community page needs to be logged in before operating")],-1),C=(0,s._)("div",{class:"tutorial-item"},[(0,s._)("button",{class:"button"},"Submit Image/Text"),(0,s._)("p",null,"Submit a story/picture that conforms to the format of this website locally to the community, and the picture needs to be the same as the story file name to be automatically matched")],-1),N=(0,s._)("div",{class:"tutorial-item"},[(0,s._)("h3",null,"Popular Novels For Reading"),(0,s._)("p",null,"The listed stories can be read by clicking on the cover")],-1),S=[_,C,N];function I(e,t,o,l,a,n){return(0,s.wg)(),(0,s.j4)(k.uT,{name:"fade"},{default:(0,s.w5)((()=>[this.store.tutorialToggle?((0,s.wg)(),(0,s.iD)("div",T,S)):(0,s.kq)("",!0)])),_:1})}var x={setup(){const e=(0,f.o)();return{store:e}}},U=o(5312);const D=(0,U.Z)(x,[["render",I]]);var P=D,H={components:{CommunityTutorial:P},setup(){const e=(0,m.W)(),t=(0,f.o)(),o=(0,b.L)();return{user:o,store:t,novelStore:e}},async mounted(){const e=(0,w.v0)();this.novelStore.novels=[],null!=e.currentUser?await this.fetchNovelsFromFirebase():alert("Please go to the Login interface to log in/register first")},methods:{async fetchNovelsFromFirebase(){const e=(0,F.cF)(y.l),t=(0,F.iH)(e,"Novels"),o=(0,F.iH)(e,"Novels-Cover"),s=await(0,F.aF)(t),l=s.items;l.forEach((async e=>{const t=await(0,F.Jt)(e),o=e.name.replace(".txt","");this.novelStore.novels.push({title:o,cover:null,content:t})}));const a=await(0,F.aF)(o),n=a.items;n.forEach((async e=>{const t=await(0,F.Jt)(e),o=e.name.replace(".png","");for(let s=0;s<this.novelStore.novels.length;s++)this.novelStore.novels[s].title===o&&(this.novelStore.novels[s].cover=t)}));const i=(0,F.iH)(e,"Novels-Cover/Default.png"),r=await(0,F.Jt)(i);this.novelStore.novels.forEach((e=>{e.cover=null===e.cover?r:e.cover}))},async uploadTextFileToFirebase(e){const t=(0,F.cF)(y.l),o=(0,F.iH)(t,`Novels/${e.name}`),s=this.user.userInfo.token,l=(0,F.B0)(o,e,{customMetadata:{firebaseAuth:s}});l.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break;default:break}}),(e=>{console.error("Upload failed:",e),alert("Uploading to the server failed, please check if you are logged in")}),(async()=>{const e=await(0,F.Jt)(o);alert("File available at",e)}))},async readNovel(e){const t=this.novelStore.novels[e].content,o=await fetch(t,{mode:"cors"});if(o.ok){const e=await o.text();this.novelStore.setCurrentNovel(e),await this.$router.push({name:"reader",query:{startReading:!0}})}else console.error("Failed to download the novel from Firebase Storage")},importFile(){const e=document.getElementById("file-input");e.setAttribute("multiple","multiple"),e.click()},onFileInputChange(e){const t=e.target.files;for(const o of t)if(o.type.startsWith("image/"))this.uploadImageFileToFirebase(o);else if("text/plain"===o.type){this.uploadTextFileToFirebase(o);const e=new FileReader;e.onload=e=>{const t=e.target.result;this.parseNovelText(t)},e.readAsText(o)}else alert("Please import a supported text or image file")},async uploadImageFileToFirebase(e){const t=(0,F.cF)(y.l),o=(0,F.iH)(t,`Novels-Cover/${e.name}`),s=this.user.userInfo.token,l=(0,F.B0)(o,e,{customMetadata:{firebaseAuth:s}});l.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break;default:break}}),(e=>{console.error("Upload failed:",e),alert("Uploading to the server failed, please check if you are logged in")}),(async()=>{const e=await(0,F.Jt)(o);alert("File available at",e)}))},parseNovelText(e){const t=e.trim().split("\n");if(this.store.btnToggle=!this.store.btnToggle,t[0].startsWith("Story Title: ")){let e=t[0].slice(13);this.novelStore.novels.push({title:e})}else alert("Please import a text file in the format used by this site")}}};const B=(0,U.Z)(H,[["render",p]]);var J=B}}]);
//# sourceMappingURL=community.63d57023.js.map