"use strict";(self["webpackChunkIDNCreaterPages"]=self["webpackChunkIDNCreaterPages"]||[]).push([[587],{738:function(e,t,o){o.r(t),o.d(t,{default:function(){return A}});var l=o(8473),s=o(4887);const n={class:"community"},a={key:0,class:"header"},i=(0,l._)("h1",{class:"h1"},"IDN Community",-1),r=[i],c={class:"header"},u=(0,l._)("h2",null,"Popular Novels For Reading",-1),d=(0,l._)("br",null,null,-1),v={class:"novels-container"},h=["onClick"],p=["src","alt"];function g(e,t,o,i,g,m){const f=(0,l.up)("CommunityTutorial");return(0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(f),i.store.btnToggle?((0,l.wg)(),(0,l.iD)("header",a,r)):(0,l.kq)("",!0),(0,l._)("header",c,[u,(0,l._)("button",{class:"button",onClick:t[0]||(t[0]=e=>m.importFile())},"Submit Image/Text"),(0,l._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[1]||(t[1]=(...e)=>m.onFileInputChange&&m.onFileInputChange(...e))},null,32)]),d,(0,l._)("div",v,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(this.novelStore.novels,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"novel-item",key:e.title},[(0,l._)("div",null,[(0,l._)("div",{onClick:e=>m.readNovel(t)},[(0,l._)("img",{src:e.cover,alt:e.title,class:"novel-cover"},null,8,p)],8,h)]),(0,l._)("h3",null,(0,s.zw)(e.title),1)])))),128))])])}o(7658);var m=o(3226),f=o(7080),b=o(5667),y=o(5204),F=o(4716),w=o(7818),k=o(9197);const _={key:0,class:"tutorial"},T=(0,l._)("div",{class:"tutorial-item"},[(0,l._)("h1",null,"IDN Community页面需要先登录再进行操作")],-1),C=(0,l._)("div",{class:"tutorial-item"},[(0,l._)("button",{class:"button"},"Submit Image/Text"),(0,l._)("p",null,"从本地提交一个符合此网站格式的故事/图片到community，图片需要和故事文件名一样才会自动匹配")],-1),N=(0,l._)("div",{class:"tutorial-item"},[(0,l._)("h3",null,"Popular Novels For Reading"),(0,l._)("p",null,"列出的故事可以通过点击封面阅读")],-1),S=[T,C,N];function I(e,t,o,s,n,a){return(0,l.wg)(),(0,l.j4)(k.uT,{name:"fade"},{default:(0,l.w5)((()=>[this.store.tutorialToggle?((0,l.wg)(),(0,l.iD)("div",_,S)):(0,l.kq)("",!0)])),_:1})}var x={setup(){const e=(0,f.o)();return{store:e}}},D=o(5312);const U=(0,D.Z)(x,[["render",I]]);var H=U,B={components:{CommunityTutorial:H},setup(){const e=(0,m.W)(),t=(0,f.o)(),o=(0,b.L)();return{user:o,store:t,novelStore:e}},async mounted(){const e=(0,w.v0)();this.novelStore.novels=[],null!=e.currentUser?await this.fetchNovelsFromFirebase():alert("请先前往Login界面登录/注册")},methods:{async fetchNovelsFromFirebase(){const e=(0,F.cF)(y.l),t=(0,F.iH)(e,"Novels"),o=(0,F.iH)(e,"Novels-Cover"),l=await(0,F.aF)(t),s=l.items;s.forEach((async e=>{const t=await(0,F.Jt)(e),o=e.name.replace(".txt","");this.novelStore.novels.push({title:o,cover:null,content:t})}));const n=await(0,F.aF)(o),a=n.items;a.forEach((async e=>{const t=await(0,F.Jt)(e),o=e.name.replace(".png","");for(let l=0;l<this.novelStore.novels.length;l++)this.novelStore.novels[l].title===o&&(this.novelStore.novels[l].cover=t)}));const i=(0,F.iH)(e,"Novels-Cover/Default.png"),r=await(0,F.Jt)(i);this.novelStore.novels.forEach((e=>{e.cover=null===e.cover?r:e.cover}))},async uploadTextFileToFirebase(e){const t=(0,F.cF)(y.l),o=(0,F.iH)(t,`Novels/${e.name}`),l=this.user.userInfo.token,s=(0,F.B0)(o,e,{customMetadata:{firebaseAuth:l}});s.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break;default:break}}),(e=>{console.error("Upload failed:",e),alert("上传到服务器失败，请检查是否在登录状态")}),(async()=>{const e=await(0,F.Jt)(o);console.log("File available at",e)}))},async readNovel(e){const t=this.novelStore.novels[e].content,o=await fetch(t,{mode:"cors"});if(o.ok){const e=await o.text();this.novelStore.setCurrentNovel(e),await this.$router.push({name:"reader",query:{startReading:!0}})}else console.error("Failed to download the novel from Firebase Storage")},importFile(){const e=document.getElementById("file-input");e.setAttribute("multiple","multiple"),e.click()},onFileInputChange(e){const t=e.target.files;for(const o of t)if(o.type.startsWith("image/"))this.uploadImageFileToFirebase(o);else if("text/plain"===o.type){this.uploadTextFileToFirebase(o);const e=new FileReader;e.onload=e=>{const t=e.target.result;this.parseNovelText(t)},e.readAsText(o)}else alert("请导入支持的文本或图片文件")},async uploadImageFileToFirebase(e){const t=(0,F.cF)(y.l),o=(0,F.iH)(t,`Novels-Cover/${e.name}`),l=this.user.userInfo.token,s=(0,F.B0)(o,e,{customMetadata:{firebaseAuth:l}});s.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break;default:break}}),(e=>{console.error("Upload failed:",e),alert("上传到服务器失败，请检查是否在登录状态")}),(async()=>{const e=await(0,F.Jt)(o);console.log("File available at",e)}))},parseNovelText(e){const t=e.trim().split("\n");if(this.store.btnToggle=!this.store.btnToggle,t[0].startsWith("Story Title: ")){let e=t[0].slice(13);this.novelStore.novels.push({title:e})}else alert("请导入此网站所使用格式的文本文件")}}};const J=(0,D.Z)(B,[["render",g]]);var A=J}}]);
//# sourceMappingURL=community.b002f142.js.map