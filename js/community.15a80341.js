"use strict";(self["webpackChunkIDNCreaterPages"]=self["webpackChunkIDNCreaterPages"]||[]).push([[587],{3226:function(e,t,o){o.d(t,{W:function(){return n}});var l=o(2386);const n=(0,l.Q_)("novelState",{state:()=>({currentNovel:null,novels:[]}),actions:{async setCurrentNovel(e){this.currentNovel=e},setNovelContent(e,t){this.novels[e].content=t}}})},3959:function(e,t,o){o.r(t),o.d(t,{default:function(){return $}});var l=o(8473),n=o(4887);const s={class:"community"},a={key:0,class:"header"},i=(0,l._)("h1",{class:"h1"},"IDN Community",-1),r=[i],c={class:"header"},u=(0,l._)("h2",null,"Popular Novels For Reading",-1),d=(0,l._)("br",null,null,-1),v={class:"novels-container"},h=["onClick"],g=["src","alt"],p={class:"header"},m=(0,l._)("h2",null,"Popular Novels For Continue",-1),f=(0,l._)("br",null,null,-1),b={class:"novels-container"},y=["onClick"],w=["src","alt"];function F(e,t,o,i,F,_){const k=(0,l.up)("CommunityTutorial");return(0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(k),i.store.btnToggle?((0,l.wg)(),(0,l.iD)("header",a,r)):(0,l.kq)("",!0),(0,l._)("header",c,[u,(0,l._)("button",{class:"button",onClick:t[0]||(t[0]=e=>_.importFile())},"Submit Image/Text"),(0,l._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[1]||(t[1]=(...e)=>_.onFileInputChange&&_.onFileInputChange(...e))},null,32)]),d,(0,l._)("div",v,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(this.novelStore.novels,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"novel-item",key:e.title},[(0,l._)("div",null,[(0,l._)("div",{onClick:e=>_.readNovel(t)},[(0,l._)("img",{src:e.cover,alt:e.title,class:"novel-cover"},null,8,g)],8,h)]),(0,l._)("h3",null,(0,n.zw)(e.title),1)])))),128))]),(0,l._)("header",p,[m,(0,l._)("button",{class:"button",onClick:t[2]||(t[2]=e=>_.importFile())},"Submit Image/Text"),(0,l._)("input",{type:"file",id:"file-input",style:{display:"none"},onChange:t[3]||(t[3]=(...e)=>_.onFileInputChange&&_.onFileInputChange(...e))},null,32)]),f,(0,l._)("div",b,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(this.novelStore.novels,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"novel-item",key:e.title},[(0,l._)("div",null,[(0,l._)("div",{onClick:e=>_.writeNovel(t)},[(0,l._)("img",{src:e.cover,alt:e.title,class:"novel-cover"},null,8,w)],8,y)]),(0,l._)("h3",null,(0,n.zw)(e.title),1)])))),128))])])}o(7658);var _=o(3226),k=o(7080),C=o(5667),N=o(5204),T=o(4716),S=o(7818),I=o(9197);const x={key:0,class:"tutorial"},D=(0,l._)("div",{class:"tutorial-item"},[(0,l._)("h1",null,"The IDN Community page needs to be logged in before operating")],-1),U=(0,l._)("div",{class:"tutorial-item"},[(0,l._)("button",{class:"button"},"Submit Image/Text"),(0,l._)("p",null,"Submit a story/picture that conforms to the format of this website locally to the community, and the picture needs to be the same as the story file name to be automatically matched")],-1),P=(0,l._)("div",{class:"tutorial-item"},[(0,l._)("h3",null,"Popular Novels For Reading"),(0,l._)("p",null,"The listed stories can be read by clicking on the cover")],-1),H=[D,U,P];function B(e,t,o,n,s,a){return(0,l.wg)(),(0,l.j4)(I.uT,{name:"fade"},{default:(0,l.w5)((()=>[this.store.tutorialToggle?((0,l.wg)(),(0,l.iD)("div",x,H)):(0,l.kq)("",!0)])),_:1})}var J={setup(){const e=(0,k.o)();return{store:e}}},R=o(5312);const W=(0,R.Z)(J,[["render",B]]);var q=W,A={components:{CommunityTutorial:q},setup(){const e=(0,_.W)(),t=(0,k.o)(),o=(0,C.L)();return{user:o,store:t,novelStore:e}},async mounted(){const e=(0,S.v0)();this.novelStore.novels=[],null!=e.currentUser?await this.fetchNovelsFromFirebase():alert("Please go to the Login interface to log in/register first")},methods:{async fetchNovelsFromFirebase(){const e=(0,T.cF)(N.l),t=(0,T.iH)(e,"Novels"),o=(0,T.iH)(e,"Novels-Cover"),l=await(0,T.aF)(t),n=l.items;n.forEach((async e=>{const t=await(0,T.Jt)(e),o=e.name.replace(".txt","");this.novelStore.novels.push({title:o,cover:null,content:t})}));const s=await(0,T.aF)(o),a=s.items;a.forEach((async e=>{const t=await(0,T.Jt)(e),o=e.name.replace(".png","");for(let l=0;l<this.novelStore.novels.length;l++)this.novelStore.novels[l].title===o&&(this.novelStore.novels[l].cover=t)}));const i=(0,T.iH)(e,"Novels-Cover/Default.png"),r=await(0,T.Jt)(i);this.novelStore.novels.forEach((e=>{e.cover=null===e.cover?r:e.cover}))},async uploadTextFileToFirebase(e){const t=(0,T.cF)(N.l),o=(0,T.iH)(t,`Novels/${e.name}`),l=this.user.userInfo.token,n=(0,T.B0)(o,e,{customMetadata:{firebaseAuth:l}});n.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break;default:break}}),(e=>{console.error("Upload failed:",e),alert("Uploading to the server failed, please check if you are logged in")}),(async()=>{const e=await(0,T.Jt)(o);alert("File available at",e)}))},async writeNovel(e){const t=this.novelStore.novels[e].content,o=await fetch(t,{mode:"cors"});if(o.ok){const e=await o.text();this.novelStore.setCurrentNovel(e),await this.$router.push({name:"author",query:{startReading:!0}})}else console.error("Failed to download the novel from Firebase Storage")},async readNovel(e){const t=this.novelStore.novels[e].content,o=await fetch(t,{mode:"cors"});if(o.ok){const e=await o.text();this.novelStore.setCurrentNovel(e),await this.$router.push({name:"reader",query:{startReading:!0}})}else console.error("Failed to download the novel from Firebase Storage")},importFile(){const e=document.getElementById("file-input");e.setAttribute("multiple","multiple"),e.click()},onFileInputChange(e){const t=e.target.files;for(const o of t)if(o.type.startsWith("image/"))this.uploadImageFileToFirebase(o);else if("text/plain"===o.type){this.uploadTextFileToFirebase(o);const e=new FileReader;e.onload=e=>{const t=e.target.result;this.parseNovelText(t)},e.readAsText(o)}else alert("Please import a supported text or image file")},async uploadImageFileToFirebase(e){const t=(0,T.cF)(N.l),o=(0,T.iH)(t,`Novels-Cover/${e.name}`),l=this.user.userInfo.token,n=(0,T.B0)(o,e,{customMetadata:{firebaseAuth:l}});n.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break;default:break}}),(e=>{console.error("Upload failed:",e),alert("Uploading to the server failed, please check if you are logged in")}),(async()=>{const e=await(0,T.Jt)(o);alert("File available at",e)}))},parseNovelText(e){const t=e.trim().split("\n");if(this.store.btnToggle=!this.store.btnToggle,t[0].startsWith("Story Title: ")){let e=t[0].slice(13);this.novelStore.novels.push({title:e})}else alert("Please import a text file in the format used by this site")}}};const E=(0,R.Z)(A,[["render",F]]);var $=E}}]);
//# sourceMappingURL=community.15a80341.js.map